#pragma config(Hubs,  S1, HTMotor,  HTMotor,  HTServo,  none)
#pragma config(Sensor, S2,     IR,             sensorHiTechnicIRSeeker1200)
#pragma config(Motor,  mtr_S1_C1_1,     RightForward,  tmotorTetrix, PIDControl, encoder)
#pragma config(Motor,  mtr_S1_C1_2,     BackSideways,  tmotorTetrix, PIDControl, encoder)
#pragma config(Motor,  mtr_S1_C2_1,     FrontSideways, tmotorTetrix, PIDControl, encoder)
#pragma config(Motor,  mtr_S1_C2_2,     LeftForward,   tmotorTetrix, PIDControl, encoder)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

#include "JoystickDriver.c"

#define ENCODERSTOP 1440

bool motorLeftForward = false; //Says whether we are testing an encoder or not
bool motorRightForward = false;
bool motorBackSideways = false;
bool motorFrontSideways = false;

task main() {
	//Initialize
	motor[LeftForward] = motor[RightForward] = motor[BackSideways] = motor[FrontSideways] = 0; //Turn off the motors
	nMotorEncoder[LeftForward] = nMotorEncoder[RightForward] = nMotorEncoder[BackSideways] = nMotorEncoder[FrontSideways] = 0; //Might as well reset the encoders too
	waitForStart();
	while(true) {
		if(joy1Btn(1)) //If button 1 is pressed, start the motor
			motor[LeftForward] = 100;
		else if(!motorLeftForward) //If we aren't testing the encoder, stop the motor
			motor[LeftForward] = 0;
		if(joy1Btn(2))
			motor[RightForward] = 100;
		else if(!motorRightForward)
			motor[RightForward] = 0;
		if(joy1Btn(3))
			motor[BackSideways] = 100;
		else if(!motorBackSideways)
			motor[BackSideways] = 0;
		if(joy1Btn(4))
			motor[FrontSideways] = 100;
		else if(!motorFrontSideways)
			motor[FrontSideways] = 0;
		if(joystick.joy1_TopHat == 0) { //Start testing encoder if top D-Pad button is pressed
			nMotorEncoder[LeftForward] = 0; //Reset the encoder
			motor[LeftForward] = 100; //Go!
			motorLeftForward = true; //Now testing LeftForward
		}
		if(joystick.joy1_TopHat == 2) { //Right D-Pad button
			nMotorEncoder[RightForward] = 0;
			motor[RightForward] = 100;
			motorRightForward = true;
		}
		if(joystick.joy1_TopHat == 4) { //Bottom D-Pad button
			nMotorEncoder[BackSideways] = 0;
			motor[BackSideways] = 100;
			motorBackSideways = true;
		}
		if(joystick.joy1_TopHat == 6) { //Left D-Pad button
			nMotorEncoder[FrontSideways] = 0;
			motor[FrontSideways] = 100;
			motorFrontSideways = true;
		}
		if(motorLeftForward && nMotorEncoder[LeftForward] >= ENCODERSTOP) { //If we are testing encoder and time to stop, stop the motor
			motor[LeftForward] = 0;
			motorLeftForward = false;
		}
		if(motorRightForward && nMotorEncoder[RightForward] >= ENCODERSTOP) {
			motor[RightForward] = 0;
			motorRightForward = false;
		}
		if(motorBackSideways && nMotorEncoder[BackSideways] >= ENCODERSTOP) {
			motor[BackSideways] = 0;
			motorBackSideways = false;
		}
		if(motorFrontSideways && nMotorEncoder[FrontSideways] >= ENCODERSTOP) {
			motor[FrontSideways] = 0;
			motorFrontSideways = false;
		}
	}
}
